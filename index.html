<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>üíê Bouquet of Love - Your Custom Masterpiece</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%; height: 100%;
      font-family: 'Georgia', serif;
      background: linear-gradient(135deg, #fff0f5 0%, #ffe4e1 100%);
      overflow-x: hidden;
    }
    .container { width: 100%; min-height: 100vh; display: flex; flex-direction: column; padding: 20px; }
    .page { display: none; width: 100%; animation: fadeIn 0.6s ease-in; }
    .page.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* Home Styling */
    .home-page {
      text-align: center; padding: 60px 30px; background: white;
      border-radius: 30px; margin: 40px auto; max-width: 700px;
      box-shadow: 0 20px 60px rgba(255, 105, 180, 0.2);
    }
    .home-page h1 { font-size: 3em; color: #d41f5b; margin-bottom: 15px; }
    .heart-btn {
      background: #ff1493; color: white; font-size: 2.5em; border-radius: 50%;
      width: 100px; height: 100px; margin: 30px auto; border: none;
      cursor: pointer; animation: heartBeat 1.5s infinite;
      display: flex; align-items: center; justify-content: center;
    }
    @keyframes heartBeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

    /* Selection Grid */
    .flower-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
    .flower-card {
      background: white; padding: 15px; border-radius: 15px; text-align: center;
      cursor: pointer; transition: 0.3s; border: 3px solid transparent;
    }
    .flower-card.selected { border-color: #ff1493; background: #fff0f5; }
    .flower-emoji { font-size: 50px; }

    /* Results Preview Logic */
    .bouquet-display {
      width: 100%; height: 650px; display: flex; align-items: center;
      justify-content: center; position: relative; overflow: hidden;
      background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    }
    #bouquet-capture-area { 
        position: relative; width: 400px; height: 550px; 
        background: white; padding: 40px;
    }
    .stem-group { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; }
    .stem {
      position: absolute; width: 3px; background: #3a6b1f;
      transform-origin: bottom center; bottom: 100px; left: 50%;
    }
    .flower-in-bouquet {
      position: absolute; width: 100px; height: 100px; font-size: 80px;
      display: flex; align-items: center; justify-content: center; z-index: 10;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.15));
    }
    .ribbon-bow {
      position: absolute; bottom: 85px; left: 50%; transform: translateX(-50%);
      font-size: 60px; z-index: 20;
    }

    .nav-btn {
      padding: 15px 30px; background: #d41f5b; color: white; border-radius: 25px;
      border: none; cursor: pointer; font-weight: bold; margin: 10px; transition: 0.3s;
    }
    .nav-btn:active { transform: scale(0.95); }
    
    .letter-textarea {
      width: 100%; max-width: 600px; padding: 15px; border-radius: 15px;
      border: 2px solid #ffd1dc; margin: 20px auto; display: block; font-family: inherit;
    }
    .status-toast {
      background: rgba(0,0,0,0.8); color: white; padding: 12px 24px; border-radius: 50px;
      position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
      display: none; z-index: 9999; font-weight: bold;
    }
  </style>
 </head>
 <body>
  <div id="status-toast" class="status-toast"></div>

  <div class="container">
    <div class="page active" id="home-page">
      <div class="home-page">
        <h1>üíê Bouquet of Love üíê</h1>
        <p>Design a stunning arrangement and share the photo with your beloved.</p>
        <button class="heart-btn" onclick="goToPage('flower-page')">‚ù§Ô∏è</button>
      </div>
    </div>

    <div class="page" id="flower-page">
      <h2 style="text-align:center; color:#d41f5b; margin:20px;">Pick Your Flowers (Max 10)</h2>
      <div class="flower-grid" id="flower-grid"></div>
      <div style="text-align:center; margin-top:30px;">
        <button class="nav-btn" onclick="goToPage('preview-page')">Create Bouquet ‚ú®</button>
      </div>
    </div>

    <div class="page" id="preview-page">
      <h2 style="text-align:center; color:#d41f5b; margin:20px;">Your Custom Bouquet üéÄ</h2>
      <div class="bouquet-display">
        <div id="bouquet-capture-area">
          <div id="bouquet-canvas"></div>
          <div class="ribbon-bow">üéÄ</div>
        </div>
      </div>
      
      <div style="text-align:center;">
        <textarea id="personal-letter" class="letter-textarea" placeholder="Add a sweet caption..."></textarea>
        <button class="nav-btn" style="background:#4CAF50;" onclick="shareAsPhoto()">üíù Share Photo to Chat</button>
        <button class="nav-btn" style="background:#666;" onclick="goToPage('flower-page')">üîÑ Edit</button>
      </div>
    </div>
  </div>

  <script>
    const flowers = [
      { name: 'Red Rose', meaning: 'Deep passionate love that burns forever', emoji: 'üåπ' },
    { name: 'Pink Rose', meaning: 'Admiration, grace, and gentle affection', emoji: 'üå∏' },
    { name: 'White Rose', meaning: 'Pure, honest, and eternal love', emoji: 'ü§ç' },
    { name: 'Red Tulip', meaning: 'Bold declaration: I choose you forever', emoji: 'üå∑' },
    { name: 'Pink Tulip', meaning: 'Care and kindness with romantic whispers', emoji: 'üå∑' },
    { name: 'Purple Orchid', meaning: 'Rare beauty and deepest admiration', emoji: 'üíú' },
    { name: 'Sunflower', meaning: 'Loyalty and devotion through all seasons', emoji: 'üåª' },
    { name: 'Lily', meaning: 'Purity of heart and refined beauty', emoji: 'üåº' },
    { name: 'Calla Lily', meaning: 'Elegance and heartfelt charm', emoji: 'üå∫' },
    { name: 'Peony', meaning: 'Romance, prosperity, and happily ever after', emoji: 'üå∏' },
    { name: 'Red Carnation', meaning: 'Admiration and deep love', emoji: 'üåπ' },
    { name: 'Pink Carnation', meaning: 'I will never forget you', emoji: 'üå∏' },
    { name: 'Daisy', meaning: 'Innocence and pure-hearted joy', emoji: 'üåº' },
    { name: 'Gerbera Daisy', meaning: 'Cheerfulness and beauty', emoji: 'üåº' },
    { name: 'Forget-Me-Not', meaning: 'True love that time cannot fade', emoji: 'üíô' },
    { name: 'Gardenia', meaning: 'Secret love and timeless affection', emoji: 'üå∏' },
    { name: 'Hydrangea', meaning: 'Heartfelt emotions overflowing', emoji: 'üíé' },
    { name: 'Ranunculus', meaning: 'Enchanted by your presence', emoji: 'üå∏' },
    { name: 'Lavender', meaning: 'Grace, serenity, and calming love', emoji: 'üíú' },
    { name: 'Magnolia', meaning: 'Dignity and natural beauty', emoji: 'üå∏' },
    { name: 'Sweet Pea', meaning: 'Joy and delicate pleasures', emoji: 'üå∏' },
    { name: 'Iris', meaning: 'Trust, faith, and eternal hope', emoji: 'üíú' },
    { name: 'Hibiscus', meaning: 'Exotic beauty and tropical passion', emoji: 'üå∫' },
    { name: 'Lotus', meaning: 'Love rising above all challenges', emoji: 'üå∏' },
    { name: 'Freesia', meaning: 'Trust and emotional honesty', emoji: 'üåº' },
    { name: 'Azalea', meaning: 'Passion with gentle grace', emoji: 'üå∏' },
    { name: 'Bluebell', meaning: 'Constancy and eternal devotion', emoji: 'üíô' },
    { name: 'Dahlia', meaning: 'Commitment and standing strong together', emoji: 'üåπ' },
    { name: 'Camellia', meaning: 'Admiration and deep desire', emoji: 'üå∫' },
    { name: 'Chrysanthemum', meaning: 'Devoted love and loyalty', emoji: 'üåª' },
    { name: 'Alstroemeria', meaning: 'Love that survives distance', emoji: 'üå∫' },
    { name: 'Zinnia', meaning: 'Lasting affection forever', emoji: 'üåº' },
    { name: 'Primrose', meaning: 'You are essential to me', emoji: 'üåº' },
    { name: 'Buttercup', meaning: 'Joy, happiness, and radiance', emoji: 'üåº' },
    { name: 'Snapdragon', meaning: 'Protection and caring love', emoji: 'üåπ' },
    { name: 'Cosmos', meaning: 'Order, harmony, and peaceful love', emoji: 'üå∏' },
    { name: 'Jasmine', meaning: 'Sensual, graceful, and romantic', emoji: 'üåº' },
    { name: 'Amaryllis', meaning: 'Pride and admiration', emoji: 'üíó' },
    { name: 'Lilac', meaning: 'First feelings of love awakening', emoji: 'üíú' },
    { name: 'Tuberose', meaning: 'Deeply intoxicating love', emoji: 'üå∏' },
    { name: 'Stock Flower', meaning: 'Lasting beauty and bonds', emoji: 'üåπ' },
    { name: 'Hyacinth', meaning: 'Sincerity and steadfast love', emoji: 'üíó' },
    { name: 'Heliotrope', meaning: 'Faithful and devoted love', emoji: 'üíú' },
    { name: 'Sweet William', meaning: 'Gallantry and admiration', emoji: 'üåπ' },
    { name: 'Anemone', meaning: 'Vulnerable, hopeful love', emoji: 'üå∏' },
    { name: 'Queen Anne Lace', meaning: 'Safety and protection', emoji: 'üåº' },
    { name: 'Poppy', meaning: 'Memory and sacrifice', emoji: 'üå∫' },
    { name: 'Gladiolus', meaning: 'Strength and character', emoji: 'üí™' },
    { name: 'Celosia', meaning: 'Passion and warmth', emoji: 'üî•' },
    { name: 'Lisianthus', meaning: 'Gratitude and appreciation', emoji: 'üå∏' }
    ];

    let selectedFlowers = [];

    function goToPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if (id === 'flower-page') renderFlowerGrid();
      if (id === 'preview-page') renderBouquet();
      window.scrollTo(0,0);
    }

    function renderFlowerGrid() {
      const grid = document.getElementById('flower-grid');
      grid.innerHTML = flowers.map((f, i) => `
        <div class="flower-card ${selectedFlowers.includes(i) ? 'selected' : ''}" onclick="toggleFlower(${i})">
          <div class="flower-emoji">${f.emoji}</div>
          <h4>${f.name}</h4>
        </div>
      `).join('');
    }

    function toggleFlower(index) {
      if (selectedFlowers.includes(index)) {
        selectedFlowers = selectedFlowers.filter(i => i !== index);
      } else if (selectedFlowers.length < 10) {
        selectedFlowers.push(index);
      }
      renderFlowerGrid();
    }

    function renderBouquet() {
      const canvas = document.getElementById('bouquet-canvas');
      canvas.innerHTML = '';
      const centerX = 200;
      const bottomY = 480; 

      const stemGroup = document.createElement('div');
      stemGroup.className = 'stem-group';

      selectedFlowers.forEach((flowerIdx, i) => {
        const flower = flowers[flowerIdx];
        const total = selectedFlowers.length;
        
        // Spread Logic (Fijau)
        const angleRange = 110;
        const startAngle = -55;
        const angle = total > 1 ? startAngle + (i * (angleRange / (total - 1))) : 0;
        const radian = (angle - 90) * (Math.PI / 180);
        const radius = 300 + (i % 2 * 30);

        const fx = centerX + Math.cos(radian) * radius;
        const fy = bottomY + Math.sin(radian) * radius;

        // Stem Logic (Ekai Thau Ma)
        const stem = document.createElement('div');
        stem.className = 'stem';
        stem.style.height = radius + 'px';
        stem.style.left = centerX + 'px';
        stem.style.transform = `rotate(${angle}deg)`;
        stemGroup.appendChild(stem);

        const flowerEl = document.createElement('div');
        flowerEl.className = 'flower-in-bouquet';
        flowerEl.style.left = (fx - 50) + 'px';
        flowerEl.style.top = (fy - 50) + 'px';
        flowerEl.innerHTML = flower.emoji;
        canvas.appendChild(flowerEl);
      });

      canvas.appendChild(stemGroup);
    }

    async function shareAsPhoto() {
      const captureArea = document.getElementById('bouquet-capture-area');
      showToast('Creating high-quality photo... üì∏');

      // Create the canvas snapshot
      const canvas = await html2canvas(captureArea, {
          backgroundColor: '#ffffff',
          scale: 3, // High resolution for mobile
          useCORS: true,
          logging: false
      });

      canvas.toBlob(async (blob) => {
          const file = new File([blob], 'my_custom_bouquet.png', { type: 'image/png' });
          const caption = document.getElementById('personal-letter').value || 'A custom bouquet just for you! ‚ù§Ô∏è';
          
          // Check if system sharing is available (Works on Android/iOS browsers)
          if (navigator.canShare && navigator.canShare({ files: [file] })) {
              try {
                  await navigator.share({
                      files: [file],
                      title: 'My Bouquet for You',
                      text: caption
                  });
              } catch (err) {
                  // Fallback if sharing is closed
                  downloadFallback(canvas);
              }
          } else {
              // Desktop Fallback: Download the photo
              downloadFallback(canvas);
          }
      }, 'image/png');
    }

    function downloadFallback(canvas) {
        const link = document.createElement('a');
        link.download = 'My_Bouquet.png';
        link.href = canvas.toDataURL();
        link.click();
        alert("Photo saved to your gallery! Now you can send it manually in any chat. üíù");
    }

    function showToast(text) {
      const toast = document.getElementById('status-toast');
      toast.textContent = text;
      toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', 3000);
    }
  </script>
 </body>
</html>